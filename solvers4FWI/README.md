The key functions used in the FWI scripts ([MultiFrequencyWaveformInvFromData.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/MultiFrequencyWaveformInvFromData.m) and [MultiFrequencyWaveformInvFromData3D.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/MultiFrequencyWaveformInvFromData3D.m)) are: 
1) [solveHelmholtzBornSeries.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/solveHelmholtzBornSeries.m) - uses the [**convergent Born series method**](https://github.com/IvoVellekoop/wavesim) to solve the 2D Helmholtz equation for multiple sources. This function is used in [MultiFrequencyWaveformInvFromData.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/MultiFrequencyWaveformInvFromData.m) to run **2D slicewise FWI**. In the presence of a GPU, this code will use MATLAB's built `gpuArray` type to accelerate the FFTs involved.
2) [ringingRemovalFilt.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/ringingRemovalFilt.m) - Helper function called during the **2D slicewise FWI** script ([MultiFrequencyWaveformInvFromData.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/MultiFrequencyWaveformInvFromData.m)) to remove ringing artifacts in the images.
3) [solveHelmholtzBornSeries3D.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/solveHelmholtzBornSeries3D.m) - uses the [**convergent Born series method**](https://github.com/IvoVellekoop/wavesim) to solve the 3D Helmholtz equation for multiple sources.  In the presence of a GPU, this code will use MATLAB's built `gpuArray` type to accelerate the FFTs involved.
4) [solveHelmholtzBornSeries3D_Batches.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/solveHelmholtzBornSeries3D_Batches.m) - Note that the GPU may not be able to compute the solution for all the sources at the same time, so we break up the sources into multiple batches: [solveHelmholtzBornSeries3D_Batches.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/solveHelmholtzBornSeries3D_Batches.m) has an extra input argument for the number of batches. Inside [solveHelmholtzBornSeries3D_Batches.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/solveHelmholtzBornSeries3D_Batches.m), we loop [solveHelmholtzBornSeries3D.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/solveHelmholtzBornSeries3D.m) over the batches to solve the 3D Helmholtz equation for all the sources.  This [solveHelmholtzBornSeries3D_Batches.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/solveHelmholtzBornSeries3D_Batches.m) function is used in [MultiFrequencyWaveformInvFromData3D.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/MultiFrequencyWaveformInvFromData3D.m) to run **3D FWI**.  See the `NUM_BATCHES` variable inside the [MultiFrequencyWaveformInvFromData3D.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/MultiFrequencyWaveformInvFromData3D.m).  Because each batch is computed serially, using fewest possible batches *should* compute the solutions in the least amount of time.  However, if using too few batches, the number of sources in each batch may be too large for the GPU to actually compute the solution (because FFTs need space).  Please adjust `NUM_BATCHES` as needed.  **Note: `NUM_BATCHES` should be a power of 2.**
5) [ringingRemovalFilt3D.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/ringingRemovalFilt3D.m) - Helper function called during the **3D FWI** script ([MultiFrequencyWaveformInvFromData3D.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/MultiFrequencyWaveformInvFromData3D.m)) to remove ringing artifacts in the images.
6) [subplus.m](https://github.com/rehmanali1994/3D-FWI-MultiRowRingArrayUST/blob/main/solvers4FWI/subplus.m) - Helper function for PML in 2D and 3D Helmholtz equation.  This function already comes with MATLAB's Curve Fitting Toolbox; however, we include this here in case you lack access to the Curve Fitting Toolbox.
